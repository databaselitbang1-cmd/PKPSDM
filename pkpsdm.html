<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKPSDM KBSI - Activity Spikes</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/dist/date-fns.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="https://i.ibb.co.com/HTTY5h8Y/PKPSDM-removebg-preview.png">
    
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --accent: #06b6d4;
            --accent2: #8b5cf6;
            --bg: #f0f4ff;
            --surface: #ffffff;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-muted: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            background-image:
                radial-gradient(ellipse at 20% 0%, rgba(59,130,246,0.08) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 100%, rgba(139,92,246,0.06) 0%, transparent 60%);
            min-height: 100vh;
            color: var(--text);
        }

        /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-light); }

        /* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
        nav {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226,232,240,0.8);
            box-shadow: 0 1px 20px rgba(30,64,175,0.07);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-logo-text {
            font-weight: 800;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        .nav-version {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--accent);
            background: rgba(6,182,212,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(6,182,212,0.2);
            vertical-align: middle;
        }

        /* ‚îÄ‚îÄ TAB BUTTONS ‚îÄ‚îÄ */
        .tab-btn {
            position: relative;
            padding: 8px 14px;
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-muted);
            border-radius: 8px;
            transition: all 0.25s ease;
            white-space: nowrap;
            border: none;
            background: transparent;
            cursor: pointer;
        }
        .tab-btn:hover { color: var(--primary); background: rgba(59,130,246,0.07); }
        .active-tab {
            color: var(--primary) !important;
            background: rgba(59,130,246,0.1) !important;
            font-weight: 700 !important;
        }
        .active-tab::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 20%;
            width: 60%;
            height: 2.5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 2px;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { width: 0; left: 50%; } to { width: 60%; left: 20%; } }

        .btn-admin {
            background: linear-gradient(135deg, #0f172a, #1e3a8a);
            color: white;
            padding: 7px 16px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(30,58,138,0.3);
        }
        .btn-admin:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(30,58,138,0.4);
            background: linear-gradient(135deg, #1e293b, #2563eb);
        }

        /* ‚îÄ‚îÄ CONNECTION STATUS ‚îÄ‚îÄ */
        #connection-status {
            font-size: 0.72rem;
            font-weight: 600;
            text-align: center;
            padding: 6px 12px;
            transition: all 0.5s ease;
            letter-spacing: 0.3px;
        }
        .status-connecting {
            background: linear-gradient(90deg, #fef3c7, #fde68a);
            color: #92400e;
            border-bottom: 1px solid #fcd34d;
        }
        .status-connected {
            background: linear-gradient(90deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border-bottom: 1px solid #6ee7b7;
        }
        .status-error {
            background: linear-gradient(90deg, #fee2e2, #fecaca);
            color: #991b1b;
            border-bottom: 1px solid #fca5a5;
        }

        /* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
        .spinner {
            display: inline-block;
            width: 12px; height: 12px;
            border: 2px solid currentColor;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
            margin-right: 6px;
            opacity: 0.7;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
        .card {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 12px rgba(30,64,175,0.05);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            overflow: hidden;
        }
        .card:hover { box-shadow: 0 6px 24px rgba(30,64,175,0.1); }

        .card-header {
            padding: 20px 24px 0;
        }
        .card-body { padding: 20px 24px 24px; }

        /* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.3px;
        }
        .section-subtitle {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.3px;
        }
        .badge-live {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .badge-live::before {
            content: '';
            width: 6px; height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse-dot 1.5s ease-in-out infinite;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        .badge-history {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            color: #5b21b6;
            border: 1px solid #c4b5fd;
        }

        /* ‚îÄ‚îÄ CHART FILTER BUTTONS ‚îÄ‚îÄ */
        .chart-filters {
            display: flex;
            background: #f1f5f9;
            padding: 3px;
            border-radius: 10px;
            gap: 2px;
        }
        .chart-filter {
            padding: 5px 12px;
            font-size: 0.72rem;
            font-weight: 600;
            border-radius: 8px;
            color: #64748b;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .chart-filter.active-filter {
            background: white;
            color: var(--primary);
            box-shadow: 0 1px 6px rgba(30,64,175,0.15);
        }
        .chart-filter:hover:not(.active-filter) { color: var(--primary); }

        /* ‚îÄ‚îÄ LEADERBOARD TABLE ‚îÄ‚îÄ */
        .lb-table { width: 100%; border-collapse: collapse; }
        .lb-table thead th {
            padding: 10px 16px;
            font-size: 0.68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            background: #f8fafc;
            border-bottom: 1px solid var(--border);
        }
        .lb-row {
            transition: all 0.25s ease;
            border-bottom: 1px solid #f1f5f9;
            animation: fadeInRow 0.4s ease both;
        }
        .lb-row:hover { background: rgba(59,130,246,0.04); }
        .lb-row td { padding: 12px 16px; font-size: 0.85rem; }
        .lb-row-top { background: linear-gradient(90deg, rgba(59,130,246,0.04), transparent); }

        @keyframes fadeInRow {
            from { opacity: 0; transform: translateX(-8px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px; height: 28px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        .rank-1 { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; box-shadow: 0 2px 8px rgba(245,158,11,0.3); }
        .rank-2 { background: linear-gradient(135deg, #f1f5f9, #e2e8f0); color: #475569; box-shadow: 0 2px 8px rgba(100,116,139,0.2); }
        .rank-3 { background: linear-gradient(135deg, #fef0e6, #fddcb8); color: #9a3412; box-shadow: 0 2px 8px rgba(234,88,12,0.2); }
        .rank-n { background: #f1f5f9; color: #64748b; }

        .point-badge {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--primary);
            background: rgba(59,130,246,0.08);
            padding: 3px 10px;
            border-radius: 6px;
        }

        /* ‚îÄ‚îÄ PROKER LIST ‚îÄ‚îÄ */
        .proker-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.25s ease;
            animation: fadeUp 0.3s ease both;
        }
        .proker-item:hover { border-color: var(--primary-light); box-shadow: 0 3px 12px rgba(59,130,246,0.1); transform: translateY(-1px); }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .proker-date-box {
            flex-shrink: 0;
            width: 48px;
            text-align: center;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-radius: 10px;
            padding: 6px 4px;
            border: 1px solid #bfdbfe;
        }
        .proker-date-month { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--primary-light); }
        .proker-date-day { font-size: 1.3rem; font-weight: 800; color: var(--primary-dark); line-height: 1.2; }

        .badge-done { background: #d1fae5; color: #065f46; border: 1px solid #6ee7b7; }
        .badge-pending { background: #fff7ed; color: #9a3412; border: 1px solid #fed7aa; }

        /* ‚îÄ‚îÄ PAGE FADE ANIMATION ‚îÄ‚îÄ */
        .page-fade {
            animation: pageFade 0.35s ease both;
        }
        @keyframes pageFade {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ‚îÄ‚îÄ SEARCH INPUT ‚îÄ‚îÄ */
        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.25s ease;
            background: white;
        }
        .search-input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(59,130,246,0.1);
        }
        .search-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: 0 2px 10px rgba(30,64,175,0.25);
            white-space: nowrap;
        }
        .search-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(30,64,175,0.35); }

        /* ‚îÄ‚îÄ PROFILE CARD ‚îÄ‚îÄ */
        .profile-avatar {
            width: 88px; height: 88px;
            border-radius: 20px;
            object-fit: cover;
            border: 3px solid white;
            box-shadow: 0 4px 16px rgba(30,64,175,0.15);
            transition: transform 0.3s ease;
        }
        .profile-avatar:hover { transform: scale(1.05); }

        /* ‚îÄ‚îÄ ADMIN PANEL ‚îÄ‚îÄ */
        .admin-header {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            border-radius: 16px 16px 0 0;
            padding: 20px 24px;
        }
        .admin-input {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 0.85rem;
            outline: none;
            transition: all 0.2s ease;
            background: white;
        }
        .admin-input:focus { border-color: var(--primary-light); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        .admin-select {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 0.85rem;
            outline: none;
            background: white;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .admin-select:focus { border-color: var(--primary-light); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: all 0.25s ease;
            box-shadow: 0 2px 10px rgba(30,64,175,0.25);
            letter-spacing: 0.3px;
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(30,64,175,0.35); }
        .btn-primary:active { transform: translateY(0); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .btn-success {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: all 0.25s ease;
            box-shadow: 0 2px 10px rgba(16,185,129,0.25);
        }
        .btn-success:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(16,185,129,0.35); }

        .btn-danger-sm {
            background: #fee2e2;
            color: #dc2626;
            border: none;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-danger-sm:hover { background: #dc2626; color: white; }

        .btn-reset-view {
            font-size: 0.72rem;
            background: #fee2e2;
            color: #dc2626;
            padding: 5px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .btn-reset-view:hover { background: #dc2626; color: white; }

        /* ‚îÄ‚îÄ CHART CLICK HINT ‚îÄ‚îÄ */
        .chart-hint {
            font-size: 0.72rem;
            text-align: center;
            color: var(--primary-light);
            background: rgba(59,130,246,0.06);
            padding: 8px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 600;
            cursor: pointer;
            border: 1px dashed rgba(59,130,246,0.2);
        }

        /* ‚îÄ‚îÄ ADMIN SECTION TITLE ‚îÄ‚îÄ */
        .admin-section-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        /* ‚îÄ‚îÄ POINT ACTION BOX ‚îÄ‚îÄ */
        .point-action-box {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 14px;
            border-radius: 12px;
            border: 1.5px solid #bfdbfe;
        }
        .point-action-label {
            font-size: 0.72rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ‚îÄ‚îÄ HIDDEN ‚îÄ‚îÄ */
        .hidden { display: none !important; }

        /* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border), transparent);
            margin: 6px 0;
        }

        /* ‚îÄ‚îÄ STAGGER ANIMATION FOR CARDS ‚îÄ‚îÄ */
        .stagger-1 { animation-delay: 0.05s; }
        .stagger-2 { animation-delay: 0.1s; }
        .stagger-3 { animation-delay: 0.15s; }
        .stagger-4 { animation-delay: 0.2s; }

        /* ‚îÄ‚îÄ TOAST NOTIFICATION ‚îÄ‚îÄ */
        #toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .toast {
            min-width: 260px;
            max-width: 360px;
            padding: 14px 18px;
            border-radius: 14px;
            font-size: 0.82rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            animation: toastIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) both;
            backdrop-filter: blur(12px);
        }
        .toast.hide { animation: toastOut 0.3s ease forwards; }
        .toast-success { background: rgba(209,250,229,0.95); color: #065f46; border: 1px solid #6ee7b7; }
        .toast-error { background: rgba(254,226,226,0.95); color: #991b1b; border: 1px solid #fca5a5; }
        .toast-info { background: rgba(219,234,254,0.95); color: #1e40af; border: 1px solid #93c5fd; }
        .toast-icon { font-size: 1rem; flex-shrink: 0; }
        @keyframes toastIn {
            from { opacity: 0; transform: translateX(40px) scale(0.9); }
            to { opacity: 1; transform: translateX(0) scale(1); }
        }
        @keyframes toastOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(40px); }
        }

        /* ‚îÄ‚îÄ FILE INPUT STYLED ‚îÄ‚îÄ */
        .file-upload-area {
            border: 2px dashed #c7d2fe;
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(238,242,255,0.5);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .file-upload-area:hover { border-color: var(--primary-light); background: rgba(219,234,254,0.5); }

        /* ‚îÄ‚îÄ MODAL / PASSWORD ‚îÄ‚îÄ */
        #admin-modal {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.6);
            backdrop-filter: blur(6px);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeOverlay 0.3s ease;
        }
        @keyframes fadeOverlay { from { opacity:0; } to { opacity:1; } }
        .modal-box {
            background: white;
            border-radius: 20px;
            padding: 32px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 20px 60px rgba(15,23,42,0.3);
            animation: modalIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) both;
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.85) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .modal-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 6px;
        }
        .modal-subtitle { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 20px; }
        .modal-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 0.9rem;
            outline: none;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 3px;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }
        .modal-input:focus { border-color: var(--primary-light); box-shadow: 0 0 0 4px rgba(59,130,246,0.1); }
        .modal-btn-row { display: flex; gap: 10px; }
        .modal-btn-cancel {
            flex: 1;
            padding: 11px;
            border-radius: 10px;
            border: 1.5px solid var(--border);
            background: white;
            color: var(--text-muted);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        .modal-btn-cancel:hover { background: #f1f5f9; }
        .modal-btn-enter {
            flex: 2;
            padding: 11px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.25s ease;
            box-shadow: 0 2px 10px rgba(30,64,175,0.3);
        }
        .modal-btn-enter:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(30,64,175,0.4); }

        /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
        @media (max-width: 640px) {
            .card-body { padding: 16px; }
            .lb-row td { padding: 10px 12px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>

    <!-- ADMIN PASSWORD MODAL -->
    <div id="admin-modal" class="hidden">
        <div class="modal-box">
            <div class="modal-title">üîê Admin Panel</div>
            <div class="modal-subtitle">Masukkan password untuk melanjutkan</div>
            <input type="password" id="modal-pw-input" class="modal-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter') confirmAdminAccess()">
            <div class="modal-btn-row">
                <button class="modal-btn-cancel" onclick="closeAdminModal()">Batal</button>
                <button class="modal-btn-enter" onclick="confirmAdminAccess()">Masuk</button>
            </div>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <img src="https://i.ibb.co.com/VbcnYg9/Litbang.jpg" alt="Logo Litbang"
                         class="h-9 w-auto object-contain rounded-lg shadow-sm hover:scale-110 transition-transform cursor-pointer"
                         onerror="this.style.display='none'">
                    <div>
                        <span class="nav-logo-text">PKPSDM</span>
                        <span class="nav-version ml-1">V2.0</span>
                    </div>
                </div>
                <div class="flex items-center space-x-1 md:space-x-3 overflow-x-auto">
                    <button onclick="switchTab('dashboard')" id="btn-dashboard" class="tab-btn active-tab">
                        <i class="fas fa-chart-line mr-1"></i>Dashboard
                    </button>
                    <button onclick="switchTab('search')" id="btn-search" class="tab-btn">
                        <i class="fas fa-search mr-1"></i>Cari Anggota
                    </button>
                    <button onclick="accessAdmin()" class="btn-admin">
                        <i class="fas fa-shield-halved mr-1"></i>ADMIN
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- CONNECTION STATUS BAR -->
    <div id="connection-status" class="status-connecting">
        <span class="spinner"></span>Menghubungkan ke Cloud Database...
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--              VIEW: DASHBOARD               -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-dashboard" class="max-w-7xl mx-auto px-4 py-8 space-y-6 page-fade">

        <!-- TOP BAR -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
            <div>
                <h1 class="text-2xl font-extrabold text-blue-900 tracking-tight">
                    Pemantauan Kinerja SDM
                    <span style="font-size:0.6rem;font-family:'JetBrains Mono',monospace;background:linear-gradient(135deg,#3b82f6,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-left:6px;">KBSI LITBANG</span>
                </h1>
                <p class="text-blue-400 text-sm mt-1 font-medium">Pemantauan Kinerja & Peningkatan Sumberdaya Manusia</p>
            </div>
            <div class="flex items-center gap-3">
                <div>
                    <p class="text-xs text-slate-400 mb-1 text-right">Snapshot Data</p>
                    <span id="display-mode-label" class="badge badge-live">LIVE ‚Äî Hari Ini</span>
                </div>
            </div>
        </div>

        <!-- CHART CARD -->
        <div class="card stagger-1 page-fade">
            <div class="card-body">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-5">
                    <div>
                        <div class="section-title"><i class="fas fa-chart-area text-indigo-400 mr-2"></i>Grafik Pengembangan SDM Gabungan</div>
                        <div class="section-subtitle">Naik = Ada Poin Masuk &nbsp;|&nbsp; Turun ke 0 = Pasif</div>
                    </div>
                    <div class="chart-filters">
                        <button onclick="updateChartFilter('weekly', this)" class="chart-filter">6 Minggu</button>
                        <button onclick="updateChartFilter('monthly', this)" class="chart-filter active-filter">6 Bulan</button>
                        <button onclick="updateChartFilter('yearly', this)" class="chart-filter">5 Tahun</button>
                    </div>
                </div>
                <div style="height:280px;position:relative;">
                    <canvas id="sdmChart"></canvas>
                </div>
                <div class="chart-hint">
                    <i class="fas fa-hand-pointer mr-1"></i>
                    Klik titik grafik untuk melihat Leaderboard pada periode tersebut
                </div>
            </div>
        </div>

        <!-- LEADERBOARD + PROKER -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- LEADERBOARD -->
            <div class="card lg:col-span-2 stagger-2 page-fade">
                <div class="card-body">
                    <div class="flex justify-between items-center mb-5">
                        <div>
                            <div class="section-title"><i class="fas fa-trophy text-amber-400 mr-2"></i>Leaderboard Point Pengembangan</div>
                        </div>
                        <button onclick="resetLeaderboardView()" id="btn-reset-view" class="btn-reset-view hidden">
                            <i class="fas fa-rotate-left mr-1"></i>Reset ke Hari Ini
                        </button>
                    </div>
                    <div class="overflow-hidden rounded-xl border border-slate-100">
                        <table class="lb-table">
                            <thead>
                                <tr>
                                    <th style="text-align:left;width:52px;">Rank</th>
                                    <th style="text-align:left;">Anggota</th>
                                    <th style="text-align:left;">Divisi</th>
                                    <th style="text-align:right;">Total Poin</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PROKER -->
            <div class="card stagger-3 page-fade">
                <div class="card-body" style="display:flex;flex-direction:column;height:100%;">
                    <div class="section-title mb-4"><i class="fas fa-calendar-days text-sky-400 mr-2"></i>Kalender Program Kerja</div>
                    <div style="flex:1;overflow-y:auto;max-height:420px;padding-right:4px;">
                        <ul id="proker-list" class="space-y-3"></ul>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--               VIEW: SEARCH                 -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-search" class="max-w-5xl mx-auto px-4 py-8 hidden page-fade">
        <div class="card">
            <div class="card-body">
                <h2 class="text-xl font-extrabold text-center text-slate-800 mb-2">Rekam Jejak Anggota</h2>
                <p class="text-center text-sm text-slate-400 mb-7">Masukkan NIM untuk melihat profil & riwayat aktivitas</p>

                <!-- SEARCH BOX -->
                <div class="flex gap-3 max-w-lg mx-auto mb-8 relative">
                    <div style="position:relative;flex:1;">
                        <i class="fas fa-id-card" style="position:absolute;left:14px;top:50%;transform:translateY(-50%);color:#94a3b8;font-size:0.85rem;"></i>
                        <input type="text" id="nim-input" placeholder="Masukkan NIM anggota..."
                               class="search-input" onkeydown="if(event.key==='Enter') searchNIM()">
                    </div>
                    <button onclick="searchNIM()" class="search-btn"><i class="fas fa-search mr-2"></i>Cari</button>
                </div>

                <!-- SEARCH RESULT -->
                <div id="search-result" class="hidden">

                    <!-- PROFILE HEADER -->
                    <div style="display:flex;align-items:flex-start;gap:18px;padding-bottom:20px;border-bottom:1px solid #e2e8f0;margin-bottom:20px;flex-wrap:wrap;">
                        <img id="res-photo" src="" class="profile-avatar" alt="Foto Profil"
                             onerror="this.src='https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png'">
                        <div style="flex:1;min-width:180px;">
                            <h3 id="res-name" class="font-extrabold text-xl text-slate-900"></h3>
                            <p class="text-sm text-slate-500 mt-1">
                                <span class="font-mono font-bold" id="res-nim"></span>
                                <span class="mx-2 text-slate-300">|</span>
                                <span id="res-role"></span>
                            </p>
                            <span id="res-div" class="inline-block mt-2 text-xs font-bold px-3 py-1 rounded-full"
                                  style="background:rgba(59,130,246,0.1);color:#1e40af;border:1px solid #bfdbfe;"></span>
                        </div>
                        <div style="text-align:right;flex-shrink:0;">
                            <span style="display:block;font-size:0.68rem;text-transform:uppercase;letter-spacing:.8px;color:#94a3b8;font-weight:700;">Total Poin</span>
                            <span id="res-total-points" style="font-size:2.8rem;font-weight:900;font-family:'JetBrains Mono',monospace;color:#1e40af;line-height:1.1;">0</span>
                        </div>
                    </div>

                    <!-- CHARTS ROW -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                        <div class="card" style="border:1px solid #e2e8f0;">
                            <div class="card-body">
                                <div class="flex justify-between items-center mb-3" style="flex-wrap:wrap;gap:8px;">
                                    <span class="section-title" style="font-size:0.85rem;"><i class="fas fa-chart-line text-indigo-400 mr-1"></i>Produktivitas Individu</span>
                                    <div class="chart-filters" style="transform:scale(0.9);transform-origin:right;">
                                        <button onclick="renderPersonalChart('weekly')" class="chart-filter">Mingguan</button>
                                        <button onclick="renderPersonalChart('monthly')" class="chart-filter active-filter">Bulanan</button>
                                        <button onclick="renderPersonalChart('yearly')" class="chart-filter">Tahunan</button>
                                    </div>
                                </div>
                                <div style="height:220px;"><canvas id="personalChart"></canvas></div>
                            </div>
                        </div>
                        <div class="card" style="border:1px solid #e2e8f0;">
                            <div class="card-body">
                                <div class="section-title mb-3" style="font-size:0.85rem;text-align:center;"><i class="fas fa-radar text-violet-400 mr-1"></i>Peta Minat</div>
                                <div style="height:220px;"><canvas id="interestRadarChart"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <!-- DETAIL ROW -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <div class="section-title mb-3" style="font-size:0.85rem;"><i class="fas fa-list-check text-slate-400 mr-1"></i>Rincian Poin</div>
                            <div style="max-height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:12px;">
                                <table style="width:100%;border-collapse:collapse;font-size:0.82rem;">
                                    <thead>
                                        <tr style="background:#f8fafc;">
                                            <th style="padding:9px 12px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Tanggal</th>
                                            <th style="padding:9px 12px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Aktivitas</th>
                                            <th style="padding:9px 12px;text-align:right;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Poin</th>
                                        </tr>
                                    </thead>
                                    <tbody id="res-points-history"></tbody>
                                </table>
                            </div>
                        </div>
                        <div>
                            <div class="section-title mb-3" style="font-size:0.85rem;"><i class="fas fa-medal text-amber-400 mr-1"></i>Prestasi</div>
                            <div style="border:1px solid #fde68a;border-radius:12px;padding:14px;background:#fffbeb;min-height:60px;">
                                <p id="res-achievements" class="text-sm text-slate-700"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ERROR STATE -->
                <div id="search-error" class="hidden" style="text-align:center;padding:24px;background:#fef2f2;border-radius:12px;border:1px solid #fecaca;color:#dc2626;font-weight:600;font-size:0.9rem;">
                    <i class="fas fa-circle-xmark text-2xl block mb-2"></i>
                    Data NIM tidak ditemukan di database.
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--               VIEW: ADMIN                  -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-admin" class="max-w-7xl mx-auto px-4 py-8 hidden page-fade">
        <!-- ADMIN HEADER -->
        <div class="admin-header flex justify-between items-center mb-0">
            <div>
                <h2 style="font-size:1.1rem;font-weight:800;color:white;"><i class="fas fa-shield-halved mr-2 text-blue-300"></i>Admin Dashboard</h2>
                <p style="font-size:0.72rem;color:#94a3b8;margin-top:3px;">Manajemen Data PKPSDM KBSI</p>
            </div>
            <button onclick="switchTab('dashboard')" style="font-size:0.75rem;background:rgba(255,255,255,0.1);color:#94a3b8;padding:7px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.15);cursor:pointer;font-weight:600;transition:all .2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                <i class="fas fa-arrow-left mr-1"></i>Keluar
            </button>
        </div>

        <div class="card" style="border-radius:0 0 16px 16px;">
            <div class="card-body space-y-8">

                <!-- ROW 1: INPUT FORM -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- FORM ANGGOTA -->
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;border:1px solid #e2e8f0;">
                        <div class="admin-section-title"><i class="fas fa-user-plus text-indigo-400 mr-2"></i>Input / Update Data Anggota</div>
                        <form id="form-member" class="space-y-3">
                            <div class="file-upload-area">
                                <i class="fas fa-camera text-slate-400"></i>
                                <input type="file" id="adm-photo" accept="image/*" class="text-xs w-full text-slate-500" style="font-family:'Plus Jakarta Sans',sans-serif;">
                            </div>
                            <input type="text" id="adm-nim" placeholder="NIM (Wajib)" class="admin-input">
                            <input type="text" id="adm-name" placeholder="Nama Lengkap" class="admin-input">
                            <div class="grid grid-cols-2 gap-2">
                                <select id="adm-div" class="admin-select">
                                    <option value="" disabled selected>‚Äî Divisi ‚Äî</option>
                                    <option value="Litbang">Litbang</option>
                                    <option value="Kemhas">Kemhas</option>
                                    <option value="Senior">Senior</option>
                                    <option value="Soskem">Soskem</option>
                                    <option value="Kominfo">Kominfo</option>
                                    <option value="Kerohanian">Kerohanian</option>
                                    <option value="BPH">BPH</option>
                                </select>
                                <select id="adm-role" class="admin-select">
                                    <option value="Anggota">Anggota</option>
                                    <option value="Sekretaris Divisi">Sekretaris Divisi</option>
                                    <option value="Kepala Divisi">Kepala Divisi</option>
                                    <option value="Sekretaris Umum">Sekretaris Umum</option>
                                    <option value="Bendahara Umum">Bendahara Umum</option>
                                    <option value="Wakil Ketua Umum">Wakil Ketua Umum</option>
                                    <option value="Ketua Umum">Ketua Umum</option>
                                </select>
                            </div>
                            <div class="point-action-box">
                                <div class="point-action-label"><i class="fas fa-plus-circle mr-1"></i>Tambah Poin Aktivitas</div>
                                <select id="adm-point-action" class="admin-select mb-2">
                                    <option value="0|No Action">‚Äî Pilih Aktivitas ‚Äî</option>
                                    <option value="1|Rapat Bulanan">1. Rapat Bulanan (1)</option>
                                    <option value="1|Saran Forum Divisi">2. Saran Forum Divisi (1)</option>
                                    <option value="1|Saran Forum Umum">3. Saran Forum Umum (1)</option>
                                    <option value="2|Anggota Panitia">4. Anggota Panitia (2)</option>
                                    <option value="2|Sidang Pleno Panitia">5. Sidang Pleno Panitia (2)</option>
                                    <option value="3|Kepala Divisi panitia">6. Kepala Divisi panitia (3)</option>
                                    <option value="3|Konsolidasi">7. Konsolidasi (3)</option>
                                    <option value="4|Sekretaris Panitia">8. Sekretaris Panitia (4)</option>
                                    <option value="4|Bendahara Panitia">9. Bendahara Panitia (4)</option>
                                    <option value="5|Ketua Panitia">10. Ketua Panitia (5)</option>
                                    <option value="5|Inovasi">11. Inovasi (5)</option>
                                </select>
                                <input type="date" id="adm-point-date" class="admin-input">
                                <p style="font-size:0.68rem;color:#64748b;margin-top:6px;"><i class="fas fa-circle-info mr-1"></i>Tanggal input mempengaruhi lonjakan grafik</p>
                            </div>
                            <input type="text" id="adm-achievements" placeholder="Prestasi (opsional)" class="admin-input">
                            <button type="button" onclick="saveMember()" id="btn-save-member" class="btn-primary">
                                <i class="fas fa-floppy-disk mr-2"></i>SIMPAN / UPDATE
                            </button>
                        </form>
                    </div>

                    <!-- FORM PROKER -->
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;border:1px solid #e2e8f0;align-self:start;">
                        <div class="admin-section-title"><i class="fas fa-calendar-plus text-green-500 mr-2"></i>Tambah Program Kerja</div>
                        <form id="form-proker" class="space-y-3">
                            <input type="text" id="adm-prog-name" placeholder="Nama Program" class="admin-input">
                            <input type="date" id="adm-prog-date" class="admin-input">
                            <textarea id="adm-prog-desc" placeholder="Keterangan program kerja..." class="admin-input" style="height:90px;resize:none;"></textarea>
                            <select id="adm-prog-status" class="admin-select">
                                <option value="Belum">Belum Selesai</option>
                                <option value="Selesai">Selesai</option>
                            </select>
                            <button type="button" onclick="addProker()" class="btn-success">
                                <i class="fas fa-plus mr-2"></i>TAMBAH PROKER
                            </button>
                        </form>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- ROW 2: MANAGEMENT TABLES -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <div class="admin-section-title"><i class="fas fa-users text-slate-500 mr-2"></i>Manajemen Data Anggota</div>
                        <div style="overflow-y:auto;max-height:260px;border:1px solid #e2e8f0;border-radius:12px;background:#f8fafc;">
                            <table style="width:100%;border-collapse:collapse;font-size:0.82rem;">
                                <thead style="position:sticky;top:0;">
                                    <tr style="background:#f1f5f9;">
                                        <th style="padding:10px 14px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">NIM ‚Äî Nama</th>
                                        <th style="padding:10px 14px;text-align:center;width:60px;border-bottom:1px solid #e2e8f0;color:#64748b;font-size:0.68rem;font-weight:700;text-transform:uppercase;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-member-list"></tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <div class="admin-section-title"><i class="fas fa-calendar-check text-slate-500 mr-2"></i>Manajemen Data Proker</div>
                        <div style="overflow-y:auto;max-height:260px;border:1px solid #e2e8f0;border-radius:12px;background:#f8fafc;">
                            <table style="width:100%;border-collapse:collapse;font-size:0.82rem;">
                                <thead style="position:sticky;top:0;">
                                    <tr style="background:#f1f5f9;">
                                        <th style="padding:10px 14px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Program ‚Äî Tanggal</th>
                                        <th style="padding:10px 14px;text-align:center;width:60px;border-bottom:1px solid #e2e8f0;color:#64748b;font-size:0.68rem;font-weight:700;text-transform:uppercase;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-proker-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- DANGER ZONE -->
                <div style="border-top:1px solid #e2e8f0;padding-top:16px;text-align:center;">
                    <button onclick="resetAllData()" style="font-size:0.75rem;color:#ef4444;background:transparent;border:1.5px solid #fecaca;padding:7px 18px;border-radius:8px;cursor:pointer;font-weight:600;transition:all .2s ease;" onmouseover="this.style.background='#fee2e2'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-triangle-exclamation mr-1"></i>Hard Reset (Hapus Semua Database)
                    </button>
                </div>

            </div>
        </div>
    </div>

    <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CONFIG & INIT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // SUPABASE ‚Äî Kredensial disimpan di satu tempat agar mudah diubah
    const SUPABASE_URL  = 'https://ponenalepjatfosrffze.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvbmVuYWxlcGphdGZvc3JmZnplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjA3NzQsImV4cCI6MjA3OTgzNjc3NH0.6Ptutr96BuCeTS_GzP8GKDSwYafdhXEjJK8F3Roxyrg';

    // PASSWORD ADMIN ‚Äî Hash sederhana (bukan plaintext di kode)
    // "admin123" di-hash dengan FNV-1a 32bit ‚Üí 0x53694CA1
    // Ganti nilai hash ini jika ingin ganti password
    const ADMIN_PW_HASH = hashFNV('admin123');

    // Fungsi hash ringan FNV-1a 32-bit (tidak butuh library)
    function hashFNV(str) {
        let h = 0x811c9dc5;
        for (let i = 0; i < str.length; i++) {
            h ^= str.charCodeAt(i);
            h = (h * 0x01000193) >>> 0;
        }
        return h.toString(16);
    }

    // Inisialisasi Supabase Client
    let _supabase;
    try {
        _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
    } catch(e) {
        showToast('Gagal inisialisasi Supabase: ' + e.message, 'error');
    }

    // ‚îÄ‚îÄ‚îÄ State Global ‚îÄ‚îÄ‚îÄ
    const localeID        = 'id-ID';
    const defaultPhoto    = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
    let members           = [];
    let prokers           = [];
    let chartInstance     = null;
    let personalChartInst = null;
    let interestRadarInst = null;
    let currentChartFilter= 'monthly';
    let currentSearchMember = null;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  TOAST SYSTEM
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function showToast(msg, type = 'info', duration = 3500) {
        const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
        const container = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast toast-${type}`;
        t.innerHTML = `<span class="toast-icon">${icons[type]||'‚ÑπÔ∏è'}</span><span>${msg}</span>`;
        container.appendChild(t);
        setTimeout(() => {
            t.classList.add('hide');
            setTimeout(() => t.remove(), 350);
        }, duration);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CONNECTION STATUS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function setStatus(state, msg) {
        const el = document.getElementById('connection-status');
        el.className = 'status-' + state;
        el.innerHTML = (state === 'connecting' ? '<span class="spinner"></span>' : '') + msg;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  INIT ON LOAD
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    document.addEventListener('DOMContentLoaded', async () => {
        // Set default date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('adm-point-date').value = today;

        await loadData();
        renderDashboard();
        renderAdminLists();
        initChart(currentChartFilter);

        // Realtime subscription
        if (_supabase) {
            _supabase.channel('pkpsdm-realtime')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'members' }, handleRealtime)
                .on('postgres_changes', { event: '*', schema: 'public', table: 'point_logs' }, handleRealtime)
                .on('postgres_changes', { event: '*', schema: 'public', table: 'prokers' }, handleRealtime)
                .subscribe((status) => {
                    if (status === 'SUBSCRIBED') {
                        setStatus('connected', 'üî¥ LIVE ‚Äî Terhubung ke Database Litbang KBSI');
                    } else if (status === 'CLOSED' || status === 'CHANNEL_ERROR') {
                        setStatus('error', '‚ö†Ô∏è Koneksi realtime terputus');
                    }
                });
        }
    });

    async function handleRealtime() {
        await loadData();
        renderDashboard();
        renderAdminLists();
        initChart(currentChartFilter);
        if (currentSearchMember) {
            const updated = members.find(m => m.nim === currentSearchMember.nim);
            if (updated) { currentSearchMember = updated; searchNIM(); }
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  FETCH DATA FROM SUPABASE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function loadData() {
        setStatus('connecting', '<span class="spinner"></span>Menyinkronkan data...');
        try {
            const [r1, r2, r3] = await Promise.all([
                _supabase.from('members').select('*'),
                _supabase.from('point_logs').select('*'),
                _supabase.from('prokers').select('*')
            ]);

            if (r1.error) throw new Error('members: ' + r1.error.message);
            if (r2.error) throw new Error('point_logs: ' + r2.error.message);
            if (r3.error) throw new Error('prokers: ' + r3.error.message);

            members = (r1.data || []).map(m => ({
                ...m,
                pointHistory: (r2.data || []).filter(l => l.nim === m.nim)
            }));
            prokers = r3.data || [];

            setStatus('connected', 'üî¥ LIVE ‚Äî Terhubung ke Database Litbang KBSI');
        } catch(err) {
            setStatus('error', '‚ö†Ô∏è Gagal memuat data: ' + err.message);
            showToast('Gagal koneksi database: ' + err.message, 'error', 5000);
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  HELPERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function parseDate(str) {
        if (!str) return new Date();
        const p = str.split('-');
        return new Date(p[0], p[1] - 1, p[2]);
    }

    function formatDateLocal(d) {
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    }

    function getPointsInPeriod(member, start, end) {
        if (!member.pointHistory) return 0;
        const s = new Date(start); s.setHours(0,0,0,0);
        const e = new Date(end);   e.setHours(23,59,59,999);
        return member.pointHistory.reduce((acc, h) => {
            const d = parseDate(h.date);
            return (d >= s && d <= e) ? acc + h.val : acc;
        }, 0);
    }

    function getCumulativePointsUntil(member, dateLimitStr) {
        if (!member.pointHistory) return 0;
        const limit = new Date(dateLimitStr); limit.setHours(23,59,59,999);
        return member.pointHistory.reduce((acc, h) => {
            return parseDate(h.date) <= limit ? acc + h.val : acc;
        }, 0);
    }

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHART DATA GENERATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function generatePeriodData(memberList, timeframe, isGlobal) {
        const labels = [], dataPoints = [], bucketEndDates = [];
        const today  = new Date();
        const count  = timeframe === 'yearly' ? 5 : 6;

        for (let i = count - 1; i >= 0; i--) {
            const d = new Date();
            let startDate, endDate, label;

            if (timeframe === 'weekly') {
                d.setDate(today.getDate() - (i * 7));
                endDate = new Date(d);
                startDate = new Date(d); startDate.setDate(endDate.getDate() - 6);
                label = `W-${getWeekNumber(endDate)}`;
            } else if (timeframe === 'monthly') {
                d.setMonth(today.getMonth() - i);
                startDate = new Date(d.getFullYear(), d.getMonth(), 1);
                endDate   = new Date(d.getFullYear(), d.getMonth() + 1, 0);
                label = startDate.toLocaleDateString(localeID, { month: 'short', year: '2-digit' });
            } else {
                d.setFullYear(today.getFullYear() - i);
                startDate = new Date(d.getFullYear(), 0, 1);
                endDate   = new Date(d.getFullYear(), 11, 31);
                label = d.getFullYear().toString();
            }

            labels.push(label);
            bucketEndDates.push(formatDateLocal(endDate));
            const val = isGlobal
                ? memberList.reduce((s, m) => s + getPointsInPeriod(m, startDate, endDate), 0)
                : getPointsInPeriod(memberList, startDate, endDate);
            dataPoints.push(val);
        }
        return { labels, dataPoints, bucketEndDates };
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHART RENDERERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function updateChartFilter(type, btn) {
        currentChartFilter = type;
        document.querySelectorAll('#view-dashboard .chart-filter').forEach(b => b.classList.remove('active-filter'));
        if (btn) btn.classList.add('active-filter');
        initChart(type);
    }

    function initChart(timeframe) {
        const ctx  = document.getElementById('sdmChart').getContext('2d');
        const data = generatePeriodData(members, timeframe, true);
        if (chartInstance) chartInstance.destroy();

        const gradient = ctx.createLinearGradient(0, 0, 0, 280);
        gradient.addColorStop(0, 'rgba(59,130,246,0.25)');
        gradient.addColorStop(1, 'rgba(59,130,246,0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Aktivitas Organisasi',
                    data: data.dataPoints,
                    borderColor: '#3b82f6',
                    backgroundColor: gradient,
                    borderWidth: 2.5,
                    pointRadius: 5,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#3b82f6',
                    pointBorderWidth: 2.5,
                    fill: true,
                    tension: 0.35
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15,23,42,0.9)',
                        titleFont: { family: 'Plus Jakarta Sans', size: 11, weight: '600' },
                        bodyFont: { family: 'JetBrains Mono', size: 13, weight: '700' },
                        padding: 12,
                        cornerRadius: 10,
                        displayColors: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(226,232,240,0.6)', drawBorder: false },
                        ticks: { font: { family: 'Plus Jakarta Sans', size: 11 }, color: '#94a3b8', precision: 0 }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { font: { family: 'Plus Jakarta Sans', size: 11 }, color: '#94a3b8' }
                    }
                },
                onClick: (e, activeEls) => {
                    if (activeEls.length > 0) {
                        renderDashboard(data.bucketEndDates[activeEls[0].index]);
                    } else {
                        renderDashboard(null);
                    }
                }
            }
        });
    }

    function renderPersonalChart(timeframe) {
        if (!currentSearchMember) return;
        // Update active filter button for personal chart
        document.querySelectorAll('#view-search .chart-filter').forEach(b => b.classList.remove('active-filter'));
        event.target && event.target.classList.add('active-filter');

        const ctx  = document.getElementById('personalChart').getContext('2d');
        const data = generatePeriodData(currentSearchMember, timeframe, false);
        if (personalChartInst) personalChartInst.destroy();

        const gradient = ctx.createLinearGradient(0, 0, 0, 220);
        gradient.addColorStop(0, 'rgba(79,70,229,0.2)');
        gradient.addColorStop(1, 'rgba(79,70,229,0)');

        personalChartInst = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Aktivitas Individu',
                    data: data.dataPoints,
                    borderColor: '#4f46e5',
                    backgroundColor: gradient,
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#4f46e5',
                    pointBorderWidth: 2,
                    fill: true,
                    tension: 0.35
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, ticks: { precision: 0, font: { size: 10 } } },
                    x: { ticks: { font: { size: 10 } } }
                }
            }
        });
    }

    function renderInterestRadar(member) {
        const ctx = document.getElementById('interestRadarChart').getContext('2d');
        const categories = {
            'Aktif Forum':    ['Rapat Bulanan', 'Konsolidasi'],
            'Kritis':         ['Saran Forum Divisi', 'Saran Forum Umum'],
            'Kepanitiaan':    ['Anggota Panitia', 'Sidang Pleno Panitia'],
            'Kepemimpinan':   ['Sekretaris Panitia', 'Bendahara Panitia', 'Ketua Panitia', 'Kepala Divisi panitia'],
            'Revolusioner':   ['Inovasi']
        };
        const scores = [0, 0, 0, 0, 0];
        const keys   = Object.keys(categories);
        if (member.pointHistory) {
            member.pointHistory.forEach(h => {
                keys.forEach((k, i) => {
                    if (categories[k].includes(h.source)) scores[i] += h.val;
                });
            });
        }
        if (interestRadarInst) interestRadarInst.destroy();
        interestRadarInst = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: keys,
                datasets: [{
                    label: 'Peta Minat',
                    data: scores,
                    fill: true,
                    backgroundColor: 'rgba(79,70,229,0.15)',
                    borderColor: '#4f46e5',
                    pointBackgroundColor: '#4f46e5',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#4f46e5',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { color: 'rgba(226,232,240,0.8)' },
                        grid: { color: 'rgba(226,232,240,0.8)' },
                        pointLabels: { font: { size: 10, family: 'Plus Jakarta Sans', weight: '600' }, color: '#475569' },
                        suggestedMin: 0,
                        ticks: { display: false, backdropColor: 'transparent' }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DASHBOARD RENDERER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderDashboard(filterDate = null) {
        const labelEl  = document.getElementById('display-mode-label');
        const btnReset = document.getElementById('btn-reset-view');
        const dateLimit = filterDate || formatDateLocal(new Date());

        if (filterDate) {
            const d = parseDate(filterDate);
            labelEl.outerHTML = `<span id="display-mode-label" class="badge badge-history">HISTORIS: ${d.toLocaleDateString(localeID, { day:'numeric', month:'long', year:'numeric' })}</span>`;
            btnReset.classList.remove('hidden');
        } else {
            labelEl.outerHTML = `<span id="display-mode-label" class="badge badge-live">LIVE ‚Äî Hari Ini</span>`;
            btnReset.classList.add('hidden');
        }

        // LEADERBOARD
        const tbody = document.getElementById('leaderboard-body');
        tbody.innerHTML = '';
        const sorted = [...members].sort((a, b) =>
            getCumulativePointsUntil(b, dateLimit) - getCumulativePointsUntil(a, dateLimit)
        );

        sorted.slice(0, 10).forEach((m, idx) => {
            const rank = idx + 1;
            const pts  = getCumulativePointsUntil(m, dateLimit);
            const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-n';
            const rowClass  = rank <= 3 ? 'lb-row lb-row-top' : 'lb-row';
            const delay     = `animation-delay:${idx * 0.04}s`;
            tbody.innerHTML += `
                <tr class="${rowClass}" style="${delay}">
                    <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                    <td style="font-weight:600;color:#0f172a;">${m.name}</td>
                    <td style="font-size:0.75rem;color:#64748b;text-transform:uppercase;letter-spacing:.5px;font-weight:600;">${m.div}</td>
                    <td style="text-align:right;"><span class="point-badge">${pts}</span></td>
                </tr>`;
        });

        if (sorted.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" style="padding:24px;text-align:center;color:#94a3b8;font-size:0.85rem;">Belum ada data anggota</td></tr>`;
        }

        // PROKER LIST
        const list = document.getElementById('proker-list');
        list.innerHTML = '';
        const sortedProkers = [...prokers].sort((a, b) => parseDate(a.date) - parseDate(b.date));
        sortedProkers.forEach((p, i) => {
            const done     = p.status === 'Selesai';
            const dateObj  = parseDate(p.date);
            const day      = dateObj.getDate();
            const month    = dateObj.toLocaleDateString(localeID, { month: 'short' });
            const delay    = `animation-delay:${i * 0.05}s`;
            list.innerHTML += `
                <li class="proker-item" style="${delay}">
                    <div class="proker-date-box">
                        <span class="proker-date-month">${month}</span>
                        <span class="proker-date-day">${day}</span>
                    </div>
                    <div style="flex:1;min-width:0;">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:6px;">
                            <p style="font-size:0.85rem;font-weight:700;color:#0f172a;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${p.name}</p>
                            <span class="badge ${done ? 'badge-done' : 'badge-pending'}" style="flex-shrink:0;">${p.status}</span>
                        </div>
                        <p style="font-size:0.72rem;color:#64748b;margin-top:3px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${p.desc || 'Tidak ada keterangan.'}</p>
                    </div>
                </li>`;
        });
        if (sortedProkers.length === 0) {
            list.innerHTML = `<li style="text-align:center;padding:24px;color:#94a3b8;font-size:0.85rem;">Belum ada program kerja</li>`;
        }
    }

    function resetLeaderboardView() { renderDashboard(null); }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SEARCH
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function searchNIM() {
        const val = document.getElementById('nim-input').value.trim();
        const m   = members.find(x => x.nim === val);
        const resultEl = document.getElementById('search-result');
        const errorEl  = document.getElementById('search-error');

        if (m) {
            currentSearchMember = m;
            resultEl.classList.remove('hidden');
            errorEl.classList.add('hidden');

            document.getElementById('res-name').textContent  = m.name;
            document.getElementById('res-nim').textContent   = m.nim;
            document.getElementById('res-role').textContent  = m.role;
            document.getElementById('res-div').textContent   = m.div;
            document.getElementById('res-total-points').textContent = getCumulativePointsUntil(m, formatDateLocal(new Date()));
            document.getElementById('res-achievements').textContent = m.achievements || '‚Äî';
            const photoEl = document.getElementById('res-photo');
            photoEl.src = m.photo || defaultPhoto;

            const histBody = document.getElementById('res-points-history');
            histBody.innerHTML = '';
            [...(m.pointHistory || [])].sort((a, b) => parseDate(b.date) - parseDate(a.date)).forEach(h => {
                histBody.innerHTML += `
                    <tr style="border-bottom:1px solid #f1f5f9;">
                        <td style="padding:8px 12px;color:#64748b;font-size:0.78rem;font-family:'JetBrains Mono',monospace;">${h.date}</td>
                        <td style="padding:8px 12px;color:#334155;font-size:0.82rem;">${h.source}</td>
                        <td style="padding:8px 12px;text-align:right;font-weight:800;color:#1e40af;font-family:'JetBrains Mono',monospace;font-size:0.82rem;">+${h.val}</td>
                    </tr>`;
            });

            renderPersonalChart('monthly');
            renderInterestRadar(m);
        } else {
            currentSearchMember = null;
            resultEl.classList.add('hidden');
            errorEl.classList.remove('hidden');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî SAVE MEMBER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function saveMember() {
        const btn = document.getElementById('btn-save-member');
        btn.innerHTML = '<span class="spinner" style="border-color:rgba(255,255,255,0.3);border-top-color:white;"></span> Menyimpan...';
        btn.disabled = true;

        const nim         = document.getElementById('adm-nim').value.trim();
        const name        = document.getElementById('adm-name').value.trim();
        const div         = document.getElementById('adm-div').value;
        const role        = document.getElementById('adm-role').value;
        const ach         = document.getElementById('adm-achievements').value.trim();
        const [pVal, pSrc]= document.getElementById('adm-point-action').value.split('|');
        const pointVal    = parseInt(pVal);
        const pointDate   = document.getElementById('adm-point-date').value;
        const fileInput   = document.getElementById('adm-photo');

        if (!nim || !name) {
            showToast('NIM dan Nama wajib diisi!', 'error');
            btn.innerHTML = '<i class="fas fa-floppy-disk mr-2"></i>SIMPAN / UPDATE';
            btn.disabled  = false;
            return;
        }

        try {
            // Foto ke Base64 (jika ada)
            let photoBase64 = null;
            if (fileInput.files.length > 0) {
                photoBase64 = await new Promise((res) => {
                    const r = new FileReader();
                    r.onload = e => res(e.target.result);
                    r.readAsDataURL(fileInput.files[0]);
                });
            }

            const upsertData = { nim, name, div, role, achievements: ach };
            if (photoBase64) upsertData.photo = photoBase64;

            // Cek apakah NIM sudah ada
            const { data: existing } = await _supabase.from('members').select('id').eq('nim', nim).single();
            if (existing) {
                const { error } = await _supabase.from('members').update(upsertData).eq('nim', nim);
                if (error) throw error;
            } else {
                const { error } = await _supabase.from('members').insert([upsertData]);
                if (error) throw error;
            }

            // Tambah poin jika dipilih
            if (pointVal > 0 && pSrc !== 'No Action') {
                const { error } = await _supabase.from('point_logs').insert([{ nim, source: pSrc, val: pointVal, date: pointDate }]);
                if (error) throw error;
            }

            showToast(`Data "${name}" berhasil disimpan!`, 'success');
            document.getElementById('form-member').reset();
            document.getElementById('adm-point-date').value = new Date().toISOString().split('T')[0];

        } catch(err) {
            showToast('Gagal menyimpan: ' + err.message, 'error', 5000);
        } finally {
            btn.innerHTML = '<i class="fas fa-floppy-disk mr-2"></i>SIMPAN / UPDATE';
            btn.disabled  = false;
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî ADD PROKER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function addProker() {
        const name   = document.getElementById('adm-prog-name').value.trim();
        const date   = document.getElementById('adm-prog-date').value;
        const status = document.getElementById('adm-prog-status').value;
        const desc   = document.getElementById('adm-prog-desc').value.trim();

        if (!name || !date) { showToast('Nama Program dan Tanggal wajib diisi!', 'error'); return; }

        const btn      = document.querySelector('#form-proker button');
        const origText = btn.innerHTML;
        btn.innerHTML  = '<span class="spinner" style="border-color:rgba(255,255,255,0.3);border-top-color:white;"></span> Menyimpan...';
        btn.disabled   = true;

        try {
            const { error } = await _supabase.from('prokers').insert([{ name, date, status, desc }]);
            if (error) throw error;
            showToast(`Proker "${name}" berhasil ditambahkan!`, 'success');
            document.getElementById('form-proker').reset();
            await loadData();
            renderDashboard();
            renderAdminLists();
        } catch(err) {
            showToast('Gagal menyimpan proker: ' + err.message, 'error', 5000);
        } finally {
            btn.innerHTML = origText;
            btn.disabled  = false;
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî DELETE MEMBER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function deleteMember(idx) {
        const m = members[idx];
        if (!m) return;
        if (!confirm(`HAPUS ANGGOTA\nNama: ${m.name}\n\nData tidak bisa dikembalikan.`)) return;
        try {
            const { error } = await _supabase.from('members').delete().eq('nim', m.nim);
            if (error) throw error;
            showToast(`Anggota "${m.name}" dihapus.`, 'info');
            await loadData(); renderAdminLists(); renderDashboard();
        } catch(err) {
            showToast('Gagal menghapus: ' + err.message, 'error');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî DELETE PROKER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function deleteProker(idx) {
        const p = prokers[idx];
        if (!p) return;
        if (!confirm(`HAPUS PROKER\nProgram: ${p.name}`)) return;
        try {
            const { error } = await _supabase.from('prokers').delete().eq('id', p.id);
            if (error) throw error;
            showToast(`Proker "${p.name}" dihapus.`, 'info');
            await loadData(); renderAdminLists(); renderDashboard();
        } catch(err) {
            showToast('Gagal menghapus proker: ' + err.message, 'error');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî HARD RESET
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function resetAllData() {
        const input = prompt("‚ö†Ô∏è PERINGATAN: Ini akan menghapus SEMUA data!\n\nKetik 'HAPUS' untuk melanjutkan:");
        if (input !== 'HAPUS') { showToast('Reset dibatalkan.', 'info'); return; }
        try {
            await _supabase.from('point_logs').delete().neq('id', 0);
            await _supabase.from('prokers').delete().neq('id', 0);
            await _supabase.from('members').delete().neq('id', 0);
            showToast('Semua data berhasil dihapus. Memuat ulang...', 'success');
            setTimeout(() => location.reload(), 1500);
        } catch(err) {
            showToast('Gagal reset: ' + err.message, 'error');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  RENDER ADMIN MANAGEMENT TABLES
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderAdminLists() {
        // --- Member List ---
        const mlist = document.getElementById('admin-member-list');
        mlist.innerHTML = '';
        if (members.length === 0) {
            mlist.innerHTML = `<tr><td colspan="2" style="padding:20px;text-align:center;color:#94a3b8;font-style:italic;font-size:0.82rem;">Belum ada data anggota</td></tr>`;
        } else {
            members.forEach((m, i) => {
                mlist.innerHTML += `
                    <tr style="border-bottom:1px solid #f1f5f9;transition:background .2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
                        <td style="padding:10px 14px;">
                            <div style="font-size:0.85rem;font-weight:700;color:#0f172a;">${m.name}</div>
                            <div style="font-size:0.72rem;color:#64748b;font-family:'JetBrains Mono',monospace;">${m.nim} ¬∑ ${m.div}</div>
                        </td>
                        <td style="padding:10px 14px;text-align:center;">
                            <button onclick="deleteMember(${i})" class="btn-danger-sm" title="Hapus Anggota">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
            });
        }

        // --- Proker List ---
        const plist = document.getElementById('admin-proker-list');
        plist.innerHTML = '';
        if (prokers.length === 0) {
            plist.innerHTML = `<tr><td colspan="2" style="padding:20px;text-align:center;color:#94a3b8;font-style:italic;font-size:0.82rem;">Belum ada proker</td></tr>`;
        } else {
            prokers.forEach((p, i) => {
                const dateStr = parseDate(p.date).toLocaleDateString(localeID, { day: 'numeric', month: 'long', year: 'numeric' });
                plist.innerHTML += `
                    <tr style="border-bottom:1px solid #f1f5f9;transition:background .2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
                        <td style="padding:10px 14px;">
                            <div style="font-size:0.85rem;font-weight:700;color:#0f172a;">${p.name}</div>
                            <div style="font-size:0.72rem;color:#64748b;">${dateStr}</div>
                        </td>
                        <td style="padding:10px 14px;text-align:center;">
                            <button onclick="deleteProker(${i})" class="btn-danger-sm" title="Hapus Proker">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
            });
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  TAB SWITCHING
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function switchTab(id) {
        document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
        const view = document.getElementById('view-' + id);
        if (view) {
            view.classList.remove('hidden');
            // Re-trigger animation
            view.classList.remove('page-fade');
            void view.offsetWidth; // reflow
            view.classList.add('page-fade');
        }

        // Update nav buttons (only for public tabs)
        if (id !== 'admin') {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            const activeBtn = document.getElementById('btn-' + id);
            if (activeBtn) activeBtn.classList.add('active-tab');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ACCESS ‚Äî MODAL (bukan prompt)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function accessAdmin() {
        const modal = document.getElementById('admin-modal');
        modal.classList.remove('hidden');
        setTimeout(() => document.getElementById('modal-pw-input').focus(), 100);
    }

    function closeAdminModal() {
        document.getElementById('admin-modal').classList.add('hidden');
        document.getElementById('modal-pw-input').value = '';
    }

    function confirmAdminAccess() {
        const input = document.getElementById('modal-pw-input').value;
        if (hashFNV(input) === ADMIN_PW_HASH) {
            closeAdminModal();
            switchTab('admin');
            showToast('Selamat datang, Admin!', 'success');
        } else {
            // Shake effect
            const box = document.querySelector('.modal-box');
            box.style.animation = 'none';
            void box.offsetWidth;
            box.style.animation = 'shake 0.4s ease';
            showToast('Password salah!', 'error');
            document.getElementById('modal-pw-input').value = '';
            document.getElementById('modal-pw-input').focus();
        }
    }

    // Tambahkan animasi shake ke CSS via JS
    const shakeStyle = document.createElement('style');
    shakeStyle.textContent = `
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            20%      { transform: translateX(-8px); }
            40%      { transform: translateX(8px); }
            60%      { transform: translateX(-6px); }
            80%      { transform: translateX(6px); }
        }
    `;
    document.head.appendChild(shakeStyle);

    // Tutup modal jika klik backdrop
    document.getElementById('admin-modal').addEventListener('click', function(e) {
        if (e.target === this) closeAdminModal();
    });

    </script>
</body>
</html>
cat >> /home/claude/pkpsdm_v2.html << 'HTMLEOF'

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--               VIEW: SEARCH                 -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-search" class="max-w-5xl mx-auto px-4 py-8 hidden page-fade">
        <div class="card">
            <div class="card-body">
                <h2 class="text-xl font-extrabold text-center text-slate-800 mb-2">Rekam Jejak Anggota</h2>
                <p class="text-center text-sm text-slate-400 mb-7">Masukkan NIM untuk melihat profil & riwayat aktivitas</p>

                <!-- SEARCH BOX -->
                <div class="flex gap-3 max-w-lg mx-auto mb-8 relative">
                    <div style="position:relative;flex:1;">
                        <i class="fas fa-id-card" style="position:absolute;left:14px;top:50%;transform:translateY(-50%);color:#94a3b8;font-size:0.85rem;"></i>
                        <input type="text" id="nim-input" placeholder="Masukkan NIM anggota..."
                               class="search-input" onkeydown="if(event.key==='Enter') searchNIM()">
                    </div>
                    <button onclick="searchNIM()" class="search-btn"><i class="fas fa-search mr-2"></i>Cari</button>
                </div>

                <!-- SEARCH RESULT -->
                <div id="search-result" class="hidden">

                    <!-- PROFILE HEADER -->
                    <div style="display:flex;align-items:flex-start;gap:18px;padding-bottom:20px;border-bottom:1px solid #e2e8f0;margin-bottom:20px;flex-wrap:wrap;">
                        <img id="res-photo" src="" class="profile-avatar" alt="Foto Profil"
                             onerror="this.src='https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png'">
                        <div style="flex:1;min-width:180px;">
                            <h3 id="res-name" class="font-extrabold text-xl text-slate-900"></h3>
                            <p class="text-sm text-slate-500 mt-1">
                                <span class="font-mono font-bold" id="res-nim"></span>
                                <span class="mx-2 text-slate-300">|</span>
                                <span id="res-role"></span>
                            </p>
                            <span id="res-div" class="inline-block mt-2 text-xs font-bold px-3 py-1 rounded-full"
                                  style="background:rgba(59,130,246,0.1);color:#1e40af;border:1px solid #bfdbfe;"></span>
                        </div>
                        <div style="text-align:right;flex-shrink:0;">
                            <span style="display:block;font-size:0.68rem;text-transform:uppercase;letter-spacing:.8px;color:#94a3b8;font-weight:700;">Total Poin</span>
                            <span id="res-total-points" style="font-size:2.8rem;font-weight:900;font-family:'JetBrains Mono',monospace;color:#1e40af;line-height:1.1;">0</span>
                        </div>
                    </div>

                    <!-- CHARTS ROW -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                        <div class="card" style="border:1px solid #e2e8f0;">
                            <div class="card-body">
                                <div class="flex justify-between items-center mb-3" style="flex-wrap:wrap;gap:8px;">
                                    <span class="section-title" style="font-size:0.85rem;"><i class="fas fa-chart-line text-indigo-400 mr-1"></i>Produktivitas Individu</span>
                                    <div class="chart-filters" style="transform:scale(0.9);transform-origin:right;">
                                        <button onclick="renderPersonalChart('weekly')" class="chart-filter">Mingguan</button>
                                        <button onclick="renderPersonalChart('monthly')" class="chart-filter active-filter">Bulanan</button>
                                        <button onclick="renderPersonalChart('yearly')" class="chart-filter">Tahunan</button>
                                    </div>
                                </div>
                                <div style="height:220px;"><canvas id="personalChart"></canvas></div>
                            </div>
                        </div>
                        <div class="card" style="border:1px solid #e2e8f0;">
                            <div class="card-body">
                                <div class="section-title mb-3" style="font-size:0.85rem;text-align:center;"><i class="fas fa-radar text-violet-400 mr-1"></i>Peta Minat</div>
                                <div style="height:220px;"><canvas id="interestRadarChart"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <!-- DETAIL ROW -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <div class="section-title mb-3" style="font-size:0.85rem;"><i class="fas fa-list-check text-slate-400 mr-1"></i>Rincian Poin</div>
                            <div style="max-height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:12px;">
                                <table style="width:100%;border-collapse:collapse;font-size:0.82rem;">
                                    <thead>
                                        <tr style="background:#f8fafc;">
                                            <th style="padding:9px 12px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Tanggal</th>
                                            <th style="padding:9px 12px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Aktivitas</th>
                                            <th style="padding:9px 12px;text-align:right;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Poin</th>
                                        </tr>
                                    </thead>
                                    <tbody id="res-points-history"></tbody>
                                </table>
                            </div>
                        </div>
                        <div>
                            <div class="section-title mb-3" style="font-size:0.85rem;"><i class="fas fa-medal text-amber-400 mr-1"></i>Prestasi</div>
                            <div style="border:1px solid #fde68a;border-radius:12px;padding:14px;background:#fffbeb;min-height:60px;">
                                <p id="res-achievements" class="text-sm text-slate-700"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ERROR STATE -->
                <div id="search-error" class="hidden" style="text-align:center;padding:24px;background:#fef2f2;border-radius:12px;border:1px solid #fecaca;color:#dc2626;font-weight:600;font-size:0.9rem;">
                    <i class="fas fa-circle-xmark text-2xl block mb-2"></i>
                    Data NIM tidak ditemukan di database.
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--               VIEW: ADMIN                  -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-admin" class="max-w-7xl mx-auto px-4 py-8 hidden page-fade">
        <!-- ADMIN HEADER -->
        <div class="admin-header flex justify-between items-center mb-0">
            <div>
                <h2 style="font-size:1.1rem;font-weight:800;color:white;"><i class="fas fa-shield-halved mr-2 text-blue-300"></i>Admin Dashboard</h2>
                <p style="font-size:0.72rem;color:#94a3b8;margin-top:3px;">Manajemen Data PKPSDM KBSI</p>
            </div>
            <button onclick="switchTab('dashboard')" style="font-size:0.75rem;background:rgba(255,255,255,0.1);color:#94a3b8;padding:7px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.15);cursor:pointer;font-weight:600;transition:all .2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                <i class="fas fa-arrow-left mr-1"></i>Keluar
            </button>
        </div>

        <div class="card" style="border-radius:0 0 16px 16px;">
            <div class="card-body space-y-8">

                <!-- ROW 1: INPUT FORM -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- FORM ANGGOTA -->
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;border:1px solid #e2e8f0;">
                        <div class="admin-section-title"><i class="fas fa-user-plus text-indigo-400 mr-2"></i>Input / Update Data Anggota</div>
                        <form id="form-member" class="space-y-3">
                            <div class="file-upload-area">
                                <i class="fas fa-camera text-slate-400"></i>
                                <input type="file" id="adm-photo" accept="image/*" class="text-xs w-full text-slate-500" style="font-family:'Plus Jakarta Sans',sans-serif;">
                            </div>
                            <input type="text" id="adm-nim" placeholder="NIM (Wajib)" class="admin-input">
                            <input type="text" id="adm-name" placeholder="Nama Lengkap" class="admin-input">
                            <div class="grid grid-cols-2 gap-2">
                                <select id="adm-div" class="admin-select">
                                    <option value="" disabled selected>‚Äî Divisi ‚Äî</option>
                                    <option value="Litbang">Litbang</option>
                                    <option value="Kemhas">Kemhas</option>
                                    <option value="Senior">Senior</option>
                                    <option value="Soskem">Soskem</option>
                                    <option value="Kominfo">Kominfo</option>
                                    <option value="Kerohanian">Kerohanian</option>
                                    <option value="BPH">BPH</option>
                                </select>
                                <select id="adm-role" class="admin-select">
                                    <option value="Anggota">Anggota</option>
                                    <option value="Sekretaris Divisi">Sekretaris Divisi</option>
                                    <option value="Kepala Divisi">Kepala Divisi</option>
                                    <option value="Sekretaris Umum">Sekretaris Umum</option>
                                    <option value="Bendahara Umum">Bendahara Umum</option>
                                    <option value="Wakil Ketua Umum">Wakil Ketua Umum</option>
                                    <option value="Ketua Umum">Ketua Umum</option>
                                </select>
                            </div>
                            <div class="point-action-box">
                                <div class="point-action-label"><i class="fas fa-plus-circle mr-1"></i>Tambah Poin Aktivitas</div>
                                <select id="adm-point-action" class="admin-select mb-2">
                                    <option value="0|No Action">‚Äî Pilih Aktivitas ‚Äî</option>
                                    <option value="1|Rapat Bulanan">1. Rapat Bulanan (1)</option>
                                    <option value="1|Saran Forum Divisi">2. Saran Forum Divisi (1)</option>
                                    <option value="1|Saran Forum Umum">3. Saran Forum Umum (1)</option>
                                    <option value="2|Anggota Panitia">4. Anggota Panitia (2)</option>
                                    <option value="2|Sidang Pleno Panitia">5. Sidang Pleno Panitia (2)</option>
                                    <option value="3|Kepala Divisi panitia">6. Kepala Divisi panitia (3)</option>
                                    <option value="3|Konsolidasi">7. Konsolidasi (3)</option>
                                    <option value="4|Sekretaris Panitia">8. Sekretaris Panitia (4)</option>
                                    <option value="4|Bendahara Panitia">9. Bendahara Panitia (4)</option>
                                    <option value="5|Ketua Panitia">10. Ketua Panitia (5)</option>
                                    <option value="5|Inovasi">11. Inovasi (5)</option>
                                </select>
                                <input type="date" id="adm-point-date" class="admin-input">
                                <p style="font-size:0.68rem;color:#64748b;margin-top:6px;"><i class="fas fa-circle-info mr-1"></i>Tanggal input mempengaruhi lonjakan grafik</p>
                            </div>
                            <input type="text" id="adm-achievements" placeholder="Prestasi (opsional)" class="admin-input">
                            <button type="button" onclick="saveMember()" id="btn-save-member" class="btn-primary">
                                <i class="fas fa-floppy-disk mr-2"></i>SIMPAN / UPDATE
                            </button>
                        </form>
                    </div>

                    <!-- FORM PROKER -->
                    <div style="background:#f8fafc;padding:20px;border-radius:14px;border:1px solid #e2e8f0;align-self:start;">
                        <div class="admin-section-title"><i class="fas fa-calendar-plus text-green-500 mr-2"></i>Tambah Program Kerja</div>
                        <form id="form-proker" class="space-y-3">
                            <input type="text" id="adm-prog-name" placeholder="Nama Program" class="admin-input">
                            <input type="date" id="adm-prog-date" class="admin-input">
                            <textarea id="adm-prog-desc" placeholder="Keterangan program kerja..." class="admin-input" style="height:90px;resize:none;"></textarea>
                            <select id="adm-prog-status" class="admin-select">
                                <option value="Belum">Belum Selesai</option>
                                <option value="Selesai">Selesai</option>
                            </select>
                            <button type="button" onclick="addProker()" class="btn-success">
                                <i class="fas fa-plus mr-2"></i>TAMBAH PROKER
                            </button>
                        </form>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- ROW 2: MANAGEMENT TABLES -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <div class="admin-section-title"><i class="fas fa-users text-slate-500 mr-2"></i>Manajemen Data Anggota</div>
                        <div style="overflow-y:auto;max-height:260px;border:1px solid #e2e8f0;border-radius:12px;background:#f8fafc;">
                            <table style="width:100%;border-collapse:collapse;font-size:0.82rem;">
                                <thead style="position:sticky;top:0;">
                                    <tr style="background:#f1f5f9;">
                                        <th style="padding:10px 14px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">NIM ‚Äî Nama</th>
                                        <th style="padding:10px 14px;text-align:center;width:60px;border-bottom:1px solid #e2e8f0;color:#64748b;font-size:0.68rem;font-weight:700;text-transform:uppercase;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-member-list"></tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <div class="admin-section-title"><i class="fas fa-calendar-check text-slate-500 mr-2"></i>Manajemen Data Proker</div>
                        <div style="overflow-y:auto;max-height:260px;border:1px solid #e2e8f0;border-radius:12px;background:#f8fafc;">
                            <table style="width:100%;border-collapse:collapse;font-size:0.82rem;">
                                <thead style="position:sticky;top:0;">
                                    <tr style="background:#f1f5f9;">
                                        <th style="padding:10px 14px;text-align:left;font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#64748b;border-bottom:1px solid #e2e8f0;">Program ‚Äî Tanggal</th>
                                        <th style="padding:10px 14px;text-align:center;width:60px;border-bottom:1px solid #e2e8f0;color:#64748b;font-size:0.68rem;font-weight:700;text-transform:uppercase;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-proker-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- DANGER ZONE -->
                <div style="border-top:1px solid #e2e8f0;padding-top:16px;text-align:center;">
                    <button onclick="resetAllData()" style="font-size:0.75rem;color:#ef4444;background:transparent;border:1.5px solid #fecaca;padding:7px 18px;border-radius:8px;cursor:pointer;font-weight:600;transition:all .2s ease;" onmouseover="this.style.background='#fee2e2'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-triangle-exclamation mr-1"></i>Hard Reset (Hapus Semua Database)
                    </button>
                </div>

            </div>
        </div>
    </div>
HTMLEOF
cat >> /home/claude/pkpsdm_v2.html << 'JSEOF'

    <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CONFIG & INIT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // SUPABASE ‚Äî Kredensial disimpan di satu tempat agar mudah diubah
    const SUPABASE_URL  = 'https://ponenalepjatfosrffze.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvbmVuYWxlcGphdGZvc3JmZnplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjA3NzQsImV4cCI6MjA3OTgzNjc3NH0.6Ptutr96BuCeTS_GzP8GKDSwYafdhXEjJK8F3Roxyrg';

    // PASSWORD ADMIN ‚Äî Hash sederhana (bukan plaintext di kode)
    // "admin123" di-hash dengan FNV-1a 32bit ‚Üí 0x53694CA1
    // Ganti nilai hash ini jika ingin ganti password
    const ADMIN_PW_HASH = hashFNV('admin123');

    // Fungsi hash ringan FNV-1a 32-bit (tidak butuh library)
    function hashFNV(str) {
        let h = 0x811c9dc5;
        for (let i = 0; i < str.length; i++) {
            h ^= str.charCodeAt(i);
            h = (h * 0x01000193) >>> 0;
        }
        return h.toString(16);
    }

    // Inisialisasi Supabase Client
    let _supabase;
    try {
        _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
    } catch(e) {
        showToast('Gagal inisialisasi Supabase: ' + e.message, 'error');
    }

    // ‚îÄ‚îÄ‚îÄ State Global ‚îÄ‚îÄ‚îÄ
    const localeID        = 'id-ID';
    const defaultPhoto    = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
    let members           = [];
    let prokers           = [];
    let chartInstance     = null;
    let personalChartInst = null;
    let interestRadarInst = null;
    let currentChartFilter= 'monthly';
    let currentSearchMember = null;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  TOAST SYSTEM
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function showToast(msg, type = 'info', duration = 3500) {
        const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
        const container = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast toast-${type}`;
        t.innerHTML = `<span class="toast-icon">${icons[type]||'‚ÑπÔ∏è'}</span><span>${msg}</span>`;
        container.appendChild(t);
        setTimeout(() => {
            t.classList.add('hide');
            setTimeout(() => t.remove(), 350);
        }, duration);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CONNECTION STATUS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function setStatus(state, msg) {
        const el = document.getElementById('connection-status');
        el.className = 'status-' + state;
        el.innerHTML = (state === 'connecting' ? '<span class="spinner"></span>' : '') + msg;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  INIT ON LOAD
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    document.addEventListener('DOMContentLoaded', async () => {
        // Set default date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('adm-point-date').value = today;

        await loadData();
        renderDashboard();
        renderAdminLists();
        initChart(currentChartFilter);

        // Realtime subscription
        if (_supabase) {
            _supabase.channel('pkpsdm-realtime')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'members' }, handleRealtime)
                .on('postgres_changes', { event: '*', schema: 'public', table: 'point_logs' }, handleRealtime)
                .on('postgres_changes', { event: '*', schema: 'public', table: 'prokers' }, handleRealtime)
                .subscribe((status) => {
                    if (status === 'SUBSCRIBED') {
                        setStatus('connected', 'üî¥ LIVE ‚Äî Terhubung ke Database Litbang KBSI');
                    } else if (status === 'CLOSED' || status === 'CHANNEL_ERROR') {
                        setStatus('error', '‚ö†Ô∏è Koneksi realtime terputus');
                    }
                });
        }
    });

    async function handleRealtime() {
        await loadData();
        renderDashboard();
        renderAdminLists();
        initChart(currentChartFilter);
        if (currentSearchMember) {
            const updated = members.find(m => m.nim === currentSearchMember.nim);
            if (updated) { currentSearchMember = updated; searchNIM(); }
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  FETCH DATA FROM SUPABASE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function loadData() {
        setStatus('connecting', '<span class="spinner"></span>Menyinkronkan data...');
        try {
            const [r1, r2, r3] = await Promise.all([
                _supabase.from('members').select('*'),
                _supabase.from('point_logs').select('*'),
                _supabase.from('prokers').select('*')
            ]);

            if (r1.error) throw new Error('members: ' + r1.error.message);
            if (r2.error) throw new Error('point_logs: ' + r2.error.message);
            if (r3.error) throw new Error('prokers: ' + r3.error.message);

            members = (r1.data || []).map(m => ({
                ...m,
                pointHistory: (r2.data || []).filter(l => l.nim === m.nim)
            }));
            prokers = r3.data || [];

            setStatus('connected', 'üî¥ LIVE ‚Äî Terhubung ke Database Litbang KBSI');
        } catch(err) {
            setStatus('error', '‚ö†Ô∏è Gagal memuat data: ' + err.message);
            showToast('Gagal koneksi database: ' + err.message, 'error', 5000);
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  HELPERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function parseDate(str) {
        if (!str) return new Date();
        const p = str.split('-');
        return new Date(p[0], p[1] - 1, p[2]);
    }

    function formatDateLocal(d) {
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    }

    function getPointsInPeriod(member, start, end) {
        if (!member.pointHistory) return 0;
        const s = new Date(start); s.setHours(0,0,0,0);
        const e = new Date(end);   e.setHours(23,59,59,999);
        return member.pointHistory.reduce((acc, h) => {
            const d = parseDate(h.date);
            return (d >= s && d <= e) ? acc + h.val : acc;
        }, 0);
    }

    function getCumulativePointsUntil(member, dateLimitStr) {
        if (!member.pointHistory) return 0;
        const limit = new Date(dateLimitStr); limit.setHours(23,59,59,999);
        return member.pointHistory.reduce((acc, h) => {
            return parseDate(h.date) <= limit ? acc + h.val : acc;
        }, 0);
    }

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHART DATA GENERATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function generatePeriodData(memberList, timeframe, isGlobal) {
        const labels = [], dataPoints = [], bucketEndDates = [];
        const today  = new Date();
        const count  = timeframe === 'yearly' ? 5 : 6;

        for (let i = count - 1; i >= 0; i--) {
            const d = new Date();
            let startDate, endDate, label;

            if (timeframe === 'weekly') {
                d.setDate(today.getDate() - (i * 7));
                endDate = new Date(d);
                startDate = new Date(d); startDate.setDate(endDate.getDate() - 6);
                label = `W-${getWeekNumber(endDate)}`;
            } else if (timeframe === 'monthly') {
                d.setMonth(today.getMonth() - i);
                startDate = new Date(d.getFullYear(), d.getMonth(), 1);
                endDate   = new Date(d.getFullYear(), d.getMonth() + 1, 0);
                label = startDate.toLocaleDateString(localeID, { month: 'short', year: '2-digit' });
            } else {
                d.setFullYear(today.getFullYear() - i);
                startDate = new Date(d.getFullYear(), 0, 1);
                endDate   = new Date(d.getFullYear(), 11, 31);
                label = d.getFullYear().toString();
            }

            labels.push(label);
            bucketEndDates.push(formatDateLocal(endDate));
            const val = isGlobal
                ? memberList.reduce((s, m) => s + getPointsInPeriod(m, startDate, endDate), 0)
                : getPointsInPeriod(memberList, startDate, endDate);
            dataPoints.push(val);
        }
        return { labels, dataPoints, bucketEndDates };
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHART RENDERERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function updateChartFilter(type, btn) {
        currentChartFilter = type;
        document.querySelectorAll('#view-dashboard .chart-filter').forEach(b => b.classList.remove('active-filter'));
        if (btn) btn.classList.add('active-filter');
        initChart(type);
    }

    function initChart(timeframe) {
        const ctx  = document.getElementById('sdmChart').getContext('2d');
        const data = generatePeriodData(members, timeframe, true);
        if (chartInstance) chartInstance.destroy();

        const gradient = ctx.createLinearGradient(0, 0, 0, 280);
        gradient.addColorStop(0, 'rgba(59,130,246,0.25)');
        gradient.addColorStop(1, 'rgba(59,130,246,0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Aktivitas Organisasi',
                    data: data.dataPoints,
                    borderColor: '#3b82f6',
                    backgroundColor: gradient,
                    borderWidth: 2.5,
                    pointRadius: 5,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#3b82f6',
                    pointBorderWidth: 2.5,
                    fill: true,
                    tension: 0.35
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15,23,42,0.9)',
                        titleFont: { family: 'Plus Jakarta Sans', size: 11, weight: '600' },
                        bodyFont: { family: 'JetBrains Mono', size: 13, weight: '700' },
                        padding: 12,
                        cornerRadius: 10,
                        displayColors: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(226,232,240,0.6)', drawBorder: false },
                        ticks: { font: { family: 'Plus Jakarta Sans', size: 11 }, color: '#94a3b8', precision: 0 }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { font: { family: 'Plus Jakarta Sans', size: 11 }, color: '#94a3b8' }
                    }
                },
                onClick: (e, activeEls) => {
                    if (activeEls.length > 0) {
                        renderDashboard(data.bucketEndDates[activeEls[0].index]);
                    } else {
                        renderDashboard(null);
                    }
                }
            }
        });
    }

    function renderPersonalChart(timeframe) {
        if (!currentSearchMember) return;
        // Update active filter button for personal chart
        document.querySelectorAll('#view-search .chart-filter').forEach(b => b.classList.remove('active-filter'));
        event.target && event.target.classList.add('active-filter');

        const ctx  = document.getElementById('personalChart').getContext('2d');
        const data = generatePeriodData(currentSearchMember, timeframe, false);
        if (personalChartInst) personalChartInst.destroy();

        const gradient = ctx.createLinearGradient(0, 0, 0, 220);
        gradient.addColorStop(0, 'rgba(79,70,229,0.2)');
        gradient.addColorStop(1, 'rgba(79,70,229,0)');

        personalChartInst = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Aktivitas Individu',
                    data: data.dataPoints,
                    borderColor: '#4f46e5',
                    backgroundColor: gradient,
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#4f46e5',
                    pointBorderWidth: 2,
                    fill: true,
                    tension: 0.35
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, ticks: { precision: 0, font: { size: 10 } } },
                    x: { ticks: { font: { size: 10 } } }
                }
            }
        });
    }

    function renderInterestRadar(member) {
        const ctx = document.getElementById('interestRadarChart').getContext('2d');
        const categories = {
            'Aktif Forum':    ['Rapat Bulanan', 'Konsolidasi'],
            'Kritis':         ['Saran Forum Divisi', 'Saran Forum Umum'],
            'Kepanitiaan':    ['Anggota Panitia', 'Sidang Pleno Panitia'],
            'Kepemimpinan':   ['Sekretaris Panitia', 'Bendahara Panitia', 'Ketua Panitia', 'Kepala Divisi panitia'],
            'Revolusioner':   ['Inovasi']
        };
        const scores = [0, 0, 0, 0, 0];
        const keys   = Object.keys(categories);
        if (member.pointHistory) {
            member.pointHistory.forEach(h => {
                keys.forEach((k, i) => {
                    if (categories[k].includes(h.source)) scores[i] += h.val;
                });
            });
        }
        if (interestRadarInst) interestRadarInst.destroy();
        interestRadarInst = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: keys,
                datasets: [{
                    label: 'Peta Minat',
                    data: scores,
                    fill: true,
                    backgroundColor: 'rgba(79,70,229,0.15)',
                    borderColor: '#4f46e5',
                    pointBackgroundColor: '#4f46e5',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#4f46e5',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { color: 'rgba(226,232,240,0.8)' },
                        grid: { color: 'rgba(226,232,240,0.8)' },
                        pointLabels: { font: { size: 10, family: 'Plus Jakarta Sans', weight: '600' }, color: '#475569' },
                        suggestedMin: 0,
                        ticks: { display: false, backdropColor: 'transparent' }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }
JSEOF
cat >> /home/claude/pkpsdm_v2.html << 'JSEOF2'

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DASHBOARD RENDERER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderDashboard(filterDate = null) {
        const labelEl  = document.getElementById('display-mode-label');
        const btnReset = document.getElementById('btn-reset-view');
        const dateLimit = filterDate || formatDateLocal(new Date());

        if (filterDate) {
            const d = parseDate(filterDate);
            labelEl.outerHTML = `<span id="display-mode-label" class="badge badge-history">HISTORIS: ${d.toLocaleDateString(localeID, { day:'numeric', month:'long', year:'numeric' })}</span>`;
            btnReset.classList.remove('hidden');
        } else {
            labelEl.outerHTML = `<span id="display-mode-label" class="badge badge-live">LIVE ‚Äî Hari Ini</span>`;
            btnReset.classList.add('hidden');
        }

        // LEADERBOARD
        const tbody = document.getElementById('leaderboard-body');
        tbody.innerHTML = '';
        const sorted = [...members].sort((a, b) =>
            getCumulativePointsUntil(b, dateLimit) - getCumulativePointsUntil(a, dateLimit)
        );

        sorted.slice(0, 10).forEach((m, idx) => {
            const rank = idx + 1;
            const pts  = getCumulativePointsUntil(m, dateLimit);
            const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-n';
            const rowClass  = rank <= 3 ? 'lb-row lb-row-top' : 'lb-row';
            const delay     = `animation-delay:${idx * 0.04}s`;
            tbody.innerHTML += `
                <tr class="${rowClass}" style="${delay}">
                    <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                    <td style="font-weight:600;color:#0f172a;">${m.name}</td>
                    <td style="font-size:0.75rem;color:#64748b;text-transform:uppercase;letter-spacing:.5px;font-weight:600;">${m.div}</td>
                    <td style="text-align:right;"><span class="point-badge">${pts}</span></td>
                </tr>`;
        });

        if (sorted.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" style="padding:24px;text-align:center;color:#94a3b8;font-size:0.85rem;">Belum ada data anggota</td></tr>`;
        }

        // PROKER LIST
        const list = document.getElementById('proker-list');
        list.innerHTML = '';
        const sortedProkers = [...prokers].sort((a, b) => parseDate(a.date) - parseDate(b.date));
        sortedProkers.forEach((p, i) => {
            const done     = p.status === 'Selesai';
            const dateObj  = parseDate(p.date);
            const day      = dateObj.getDate();
            const month    = dateObj.toLocaleDateString(localeID, { month: 'short' });
            const delay    = `animation-delay:${i * 0.05}s`;
            list.innerHTML += `
                <li class="proker-item" style="${delay}">
                    <div class="proker-date-box">
                        <span class="proker-date-month">${month}</span>
                        <span class="proker-date-day">${day}</span>
                    </div>
                    <div style="flex:1;min-width:0;">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:6px;">
                            <p style="font-size:0.85rem;font-weight:700;color:#0f172a;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${p.name}</p>
                            <span class="badge ${done ? 'badge-done' : 'badge-pending'}" style="flex-shrink:0;">${p.status}</span>
                        </div>
                        <p style="font-size:0.72rem;color:#64748b;margin-top:3px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${p.desc || 'Tidak ada keterangan.'}</p>
                    </div>
                </li>`;
        });
        if (sortedProkers.length === 0) {
            list.innerHTML = `<li style="text-align:center;padding:24px;color:#94a3b8;font-size:0.85rem;">Belum ada program kerja</li>`;
        }
    }

    function resetLeaderboardView() { renderDashboard(null); }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SEARCH
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function searchNIM() {
        const val = document.getElementById('nim-input').value.trim();
        const m   = members.find(x => x.nim === val);
        const resultEl = document.getElementById('search-result');
        const errorEl  = document.getElementById('search-error');

        if (m) {
            currentSearchMember = m;
            resultEl.classList.remove('hidden');
            errorEl.classList.add('hidden');

            document.getElementById('res-name').textContent  = m.name;
            document.getElementById('res-nim').textContent   = m.nim;
            document.getElementById('res-role').textContent  = m.role;
            document.getElementById('res-div').textContent   = m.div;
            document.getElementById('res-total-points').textContent = getCumulativePointsUntil(m, formatDateLocal(new Date()));
            document.getElementById('res-achievements').textContent = m.achievements || '‚Äî';
            const photoEl = document.getElementById('res-photo');
            photoEl.src = m.photo || defaultPhoto;

            const histBody = document.getElementById('res-points-history');
            histBody.innerHTML = '';
            [...(m.pointHistory || [])].sort((a, b) => parseDate(b.date) - parseDate(a.date)).forEach(h => {
                histBody.innerHTML += `
                    <tr style="border-bottom:1px solid #f1f5f9;">
                        <td style="padding:8px 12px;color:#64748b;font-size:0.78rem;font-family:'JetBrains Mono',monospace;">${h.date}</td>
                        <td style="padding:8px 12px;color:#334155;font-size:0.82rem;">${h.source}</td>
                        <td style="padding:8px 12px;text-align:right;font-weight:800;color:#1e40af;font-family:'JetBrains Mono',monospace;font-size:0.82rem;">+${h.val}</td>
                    </tr>`;
            });

            renderPersonalChart('monthly');
            renderInterestRadar(m);
        } else {
            currentSearchMember = null;
            resultEl.classList.add('hidden');
            errorEl.classList.remove('hidden');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî SAVE MEMBER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function saveMember() {
        const btn = document.getElementById('btn-save-member');
        btn.innerHTML = '<span class="spinner" style="border-color:rgba(255,255,255,0.3);border-top-color:white;"></span> Menyimpan...';
        btn.disabled = true;

        const nim         = document.getElementById('adm-nim').value.trim();
        const name        = document.getElementById('adm-name').value.trim();
        const div         = document.getElementById('adm-div').value;
        const role        = document.getElementById('adm-role').value;
        const ach         = document.getElementById('adm-achievements').value.trim();
        const [pVal, pSrc]= document.getElementById('adm-point-action').value.split('|');
        const pointVal    = parseInt(pVal);
        const pointDate   = document.getElementById('adm-point-date').value;
        const fileInput   = document.getElementById('adm-photo');

        if (!nim || !name) {
            showToast('NIM dan Nama wajib diisi!', 'error');
            btn.innerHTML = '<i class="fas fa-floppy-disk mr-2"></i>SIMPAN / UPDATE';
            btn.disabled  = false;
            return;
        }

        try {
            // Foto ke Base64 (jika ada)
            let photoBase64 = null;
            if (fileInput.files.length > 0) {
                photoBase64 = await new Promise((res) => {
                    const r = new FileReader();
                    r.onload = e => res(e.target.result);
                    r.readAsDataURL(fileInput.files[0]);
                });
            }

            const upsertData = { nim, name, div, role, achievements: ach };
            if (photoBase64) upsertData.photo = photoBase64;

            // Cek apakah NIM sudah ada
            const { data: existing } = await _supabase.from('members').select('id').eq('nim', nim).single();
            if (existing) {
                const { error } = await _supabase.from('members').update(upsertData).eq('nim', nim);
                if (error) throw error;
            } else {
                const { error } = await _supabase.from('members').insert([upsertData]);
                if (error) throw error;
            }

            // Tambah poin jika dipilih
            if (pointVal > 0 && pSrc !== 'No Action') {
                const { error } = await _supabase.from('point_logs').insert([{ nim, source: pSrc, val: pointVal, date: pointDate }]);
                if (error) throw error;
            }

            showToast(`Data "${name}" berhasil disimpan!`, 'success');
            document.getElementById('form-member').reset();
            document.getElementById('adm-point-date').value = new Date().toISOString().split('T')[0];

        } catch(err) {
            showToast('Gagal menyimpan: ' + err.message, 'error', 5000);
        } finally {
            btn.innerHTML = '<i class="fas fa-floppy-disk mr-2"></i>SIMPAN / UPDATE';
            btn.disabled  = false;
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî ADD PROKER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function addProker() {
        const name   = document.getElementById('adm-prog-name').value.trim();
        const date   = document.getElementById('adm-prog-date').value;
        const status = document.getElementById('adm-prog-status').value;
        const desc   = document.getElementById('adm-prog-desc').value.trim();

        if (!name || !date) { showToast('Nama Program dan Tanggal wajib diisi!', 'error'); return; }

        const btn      = document.querySelector('#form-proker button');
        const origText = btn.innerHTML;
        btn.innerHTML  = '<span class="spinner" style="border-color:rgba(255,255,255,0.3);border-top-color:white;"></span> Menyimpan...';
        btn.disabled   = true;

        try {
            const { error } = await _supabase.from('prokers').insert([{ name, date, status, desc }]);
            if (error) throw error;
            showToast(`Proker "${name}" berhasil ditambahkan!`, 'success');
            document.getElementById('form-proker').reset();
            await loadData();
            renderDashboard();
            renderAdminLists();
        } catch(err) {
            showToast('Gagal menyimpan proker: ' + err.message, 'error', 5000);
        } finally {
            btn.innerHTML = origText;
            btn.disabled  = false;
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî DELETE MEMBER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function deleteMember(idx) {
        const m = members[idx];
        if (!m) return;
        if (!confirm(`HAPUS ANGGOTA\nNama: ${m.name}\n\nData tidak bisa dikembalikan.`)) return;
        try {
            const { error } = await _supabase.from('members').delete().eq('nim', m.nim);
            if (error) throw error;
            showToast(`Anggota "${m.name}" dihapus.`, 'info');
            await loadData(); renderAdminLists(); renderDashboard();
        } catch(err) {
            showToast('Gagal menghapus: ' + err.message, 'error');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî DELETE PROKER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function deleteProker(idx) {
        const p = prokers[idx];
        if (!p) return;
        if (!confirm(`HAPUS PROKER\nProgram: ${p.name}`)) return;
        try {
            const { error } = await _supabase.from('prokers').delete().eq('id', p.id);
            if (error) throw error;
            showToast(`Proker "${p.name}" dihapus.`, 'info');
            await loadData(); renderAdminLists(); renderDashboard();
        } catch(err) {
            showToast('Gagal menghapus proker: ' + err.message, 'error');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ‚Äî HARD RESET
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function resetAllData() {
        const input = prompt("‚ö†Ô∏è PERINGATAN: Ini akan menghapus SEMUA data!\n\nKetik 'HAPUS' untuk melanjutkan:");
        if (input !== 'HAPUS') { showToast('Reset dibatalkan.', 'info'); return; }
        try {
            await _supabase.from('point_logs').delete().neq('id', 0);
            await _supabase.from('prokers').delete().neq('id', 0);
            await _supabase.from('members').delete().neq('id', 0);
            showToast('Semua data berhasil dihapus. Memuat ulang...', 'success');
            setTimeout(() => location.reload(), 1500);
        } catch(err) {
            showToast('Gagal reset: ' + err.message, 'error');
        }
    }
JSEOF2
        cat >> /home/claude/pkpsdm_v2.html << 'JSEOF3'

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  RENDER ADMIN MANAGEMENT TABLES
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderAdminLists() {
        // --- Member List ---
        const mlist = document.getElementById('admin-member-list');
        mlist.innerHTML = '';
        if (members.length === 0) {
            mlist.innerHTML = `<tr><td colspan="2" style="padding:20px;text-align:center;color:#94a3b8;font-style:italic;font-size:0.82rem;">Belum ada data anggota</td></tr>`;
        } else {
            members.forEach((m, i) => {
                mlist.innerHTML += `
                    <tr style="border-bottom:1px solid #f1f5f9;transition:background .2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
                        <td style="padding:10px 14px;">
                            <div style="font-size:0.85rem;font-weight:700;color:#0f172a;">${m.name}</div>
                            <div style="font-size:0.72rem;color:#64748b;font-family:'JetBrains Mono',monospace;">${m.nim} ¬∑ ${m.div}</div>
                        </td>
                        <td style="padding:10px 14px;text-align:center;">
                            <button onclick="deleteMember(${i})" class="btn-danger-sm" title="Hapus Anggota">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
            });
        }

        // --- Proker List ---
        const plist = document.getElementById('admin-proker-list');
        plist.innerHTML = '';
        if (prokers.length === 0) {
            plist.innerHTML = `<tr><td colspan="2" style="padding:20px;text-align:center;color:#94a3b8;font-style:italic;font-size:0.82rem;">Belum ada proker</td></tr>`;
        } else {
            prokers.forEach((p, i) => {
                const dateStr = parseDate(p.date).toLocaleDateString(localeID, { day: 'numeric', month: 'long', year: 'numeric' });
                plist.innerHTML += `
                    <tr style="border-bottom:1px solid #f1f5f9;transition:background .2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background=''">
                        <td style="padding:10px 14px;">
                            <div style="font-size:0.85rem;font-weight:700;color:#0f172a;">${p.name}</div>
                            <div style="font-size:0.72rem;color:#64748b;">${dateStr}</div>
                        </td>
                        <td style="padding:10px 14px;text-align:center;">
                            <button onclick="deleteProker(${i})" class="btn-danger-sm" title="Hapus Proker">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
            });
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  TAB SWITCHING
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function switchTab(id) {
        document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
        const view = document.getElementById('view-' + id);
        if (view) {
            view.classList.remove('hidden');
            // Re-trigger animation
            view.classList.remove('page-fade');
            void view.offsetWidth; // reflow
            view.classList.add('page-fade');
        }

        // Update nav buttons (only for public tabs)
        if (id !== 'admin') {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            const activeBtn = document.getElementById('btn-' + id);
            if (activeBtn) activeBtn.classList.add('active-tab');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ADMIN ACCESS ‚Äî MODAL (bukan prompt)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function accessAdmin() {
        const modal = document.getElementById('admin-modal');
        modal.classList.remove('hidden');
        setTimeout(() => document.getElementById('modal-pw-input').focus(), 100);
    }

    function closeAdminModal() {
        document.getElementById('admin-modal').classList.add('hidden');
        document.getElementById('modal-pw-input').value = '';
    }

    function confirmAdminAccess() {
        const input = document.getElementById('modal-pw-input').value;
        if (hashFNV(input) === ADMIN_PW_HASH) {
            closeAdminModal();
            switchTab('admin');
            showToast('Selamat datang, Admin!', 'success');
        } else {
            // Shake effect
            const box = document.querySelector('.modal-box');
            box.style.animation = 'none';
            void box.offsetWidth;
            box.style.animation = 'shake 0.4s ease';
            showToast('Password salah!', 'error');
            document.getElementById('modal-pw-input').value = '';
            document.getElementById('modal-pw-input').focus();
        }
    }

    // Tambahkan animasi shake ke CSS via JS
    const shakeStyle = document.createElement('style');
    shakeStyle.textContent = `
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            20%      { transform: translateX(-8px); }
            40%      { transform: translateX(8px); }
            60%      { transform: translateX(-6px); }
            80%      { transform: translateX(6px); }
        }
    `;
    document.head.appendChild(shakeStyle);

    // Tutup modal jika klik backdrop
    document.getElementById('admin-modal').addEventListener('click', function(e) {
        if (e.target === this) closeAdminModal();
    });

    </script>
</body>
</html>
JSEOF3
